{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/alkhastvatsaev/Desktop/COURSES/hopla/app/components/TrackingMap.tsx"],"sourcesContent":["\n'use client';\n\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport { useEffect, useState } from 'react';\n\n// Custom Destination Icon (Enhanced Minimalist Apple-style)\nconst DestinationIcon = L.divIcon({\n  className: 'custom-dest-icon',\n  html: `\n    <div style=\"display: flex; flex-direction: column; align-items: center;\">\n      <div style=\"\n        background: #34C759; \n        width: 24px; height: 24px; \n        border: 3px solid white;\n        border-radius: 50%; \n        box-shadow: 0 4px 15px rgba(0,0,0,0.15);\n        display: flex; align-items: center; justify-content: center;\n      \">\n         <div style=\"width: 6px; height: 6px; background: white; border-radius: 50%;\"></div>\n      </div>\n      <div style=\"\n        width: 4px; height: 6px; \n        background: white; \n        margin-top: -2px;\n        clip-path: polygon(0 0, 100% 0, 50% 100%);\n      \"></div>\n    </div>\n  `,\n  iconSize: [30, 30],\n  iconAnchor: [15, 28]\n});\n\n// Custom Driver Icon\nconst DriverIcon = L.divIcon({\n  className: 'custom-driver-icon',\n  html: `\n    <div style=\"\n      background: #007AFF; \n      width: 40px; \n      height: 40px; \n      border-radius: 50%; \n      border: 3px solid white; \n      box-shadow: 0 4px 10px rgba(0,0,0,0.2);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n    \">\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"/><polyline points=\"9 22 9 12 15 12 15 22\"/></svg>\n    </div>\n  `,\n  iconSize: [40, 40],\n  iconAnchor: [20, 20]\n});\n\n// Component to handle map center updates\nfunction ChangeView({ center }: { center: [number, number] }) {\n  const map = useMap();\n  useEffect(() => {\n    if (map && center && !isNaN(center[0])) {\n      map.setView(center, map.getZoom());\n    }\n  }, [center, map]);\n  return null;\n}\n\nexport default function TrackingMap({ status, clientCoords }: { status: string, clientCoords?: {lat: number, lng: number} }) {\n  // Strasbourg default fallback\n  const strasbourgCenter: [number, number] = [48.5734, 7.7521];\n  \n  const [driverPos, setDriverPos] = useState<[number, number]>(strasbourgCenter);\n  const [clientPos, setClientPos] = useState<[number, number]>(\n    clientCoords ? [clientCoords.lat, clientCoords.lng] : strasbourgCenter\n  );\n\n  // Update center when clientCoords change\n  useEffect(() => {\n    if (clientCoords && !isNaN(clientCoords.lat)) {\n      setClientPos([clientCoords.lat, clientCoords.lng]);\n    }\n  }, [clientCoords]);\n\n  useEffect(() => {\n    if (status === 'taken' || status === 'delivering') {\n      const interval = setInterval(() => {\n        setDriverPos(prev => [\n          prev[0] + (Math.random() - 0.5) * 0.001,\n          prev[1] + (Math.random() - 0.5) * 0.001\n        ]);\n      }, 5000);\n      return () => clearInterval(interval);\n    }\n  }, [status]);\n\n  if (typeof window === 'undefined') return null;\n\n  return (\n    <div style={{ height: '100%', width: '100%', position: 'relative' }}>\n      <MapContainer \n        id=\"hopla-map-container\"\n        key=\"stable-hopla-map-v2\"\n        center={clientPos} \n        zoom={14} \n        scrollWheelZoom={false}\n        style={{ height: '100%', width: '100%', background: '#f5f5f7' }}\n        zoomControl={false}\n      >\n        <TileLayer\n          attribution='&copy; <a href=\"https://carto.com/\">CARTO</a>'\n          url=\"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png\"\n          className=\"map-tiles\"\n        />\n        \n        <ChangeView center={status === 'open' ? clientPos : driverPos} />\n\n        {/* Client Position */}\n        <Marker position={clientPos} icon={DestinationIcon}>\n          <Popup>Votre destination</Popup>\n        </Marker>\n\n        {/* Driver Position (Visible if assigned) */}\n        {status !== 'open' && (\n          <Marker position={driverPos} icon={DriverIcon}>\n            <Popup>Votre livreur est ici</Popup>\n          </Marker>\n        )}\n      </MapContainer>\n\n      <style jsx global>{`\n        .map-tiles {\n          filter: saturate(1.1) brightness(1.02); /* Softer, natural modern feel */\n        }\n        .leaflet-container {\n          background: #f5f5f7 !important;\n        }\n        .custom-driver-icon {\n          transition: all 5s linear !important;\n        }\n      `}</style>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;AAJA;;;;;AAMA,4DAA4D;AAC5D,MAAM,kBAAkB,8LAAC,CAAC,OAAO,CAAC;IAChC,WAAW;IACX,MAAM,CAAC;;;;;;;;;;;;;;;;;;;EAmBP,CAAC;IACD,UAAU;QAAC;QAAI;KAAG;IAClB,YAAY;QAAC;QAAI;KAAG;AACtB;AAEA,qBAAqB;AACrB,MAAM,aAAa,8LAAC,CAAC,OAAO,CAAC;IAC3B,WAAW;IACX,MAAM,CAAC;;;;;;;;;;;;;;;EAeP,CAAC;IACD,UAAU;QAAC;QAAI;KAAG;IAClB,YAAY;QAAC;QAAI;KAAG;AACtB;AAEA,yCAAyC;AACzC,SAAS,WAAW,EAAE,MAAM,EAAgC;;IAC1D,MAAM,MAAM,IAAA,4LAAM;IAClB,IAAA,yMAAS;gCAAC;YACR,IAAI,OAAO,UAAU,CAAC,MAAM,MAAM,CAAC,EAAE,GAAG;gBACtC,IAAI,OAAO,CAAC,QAAQ,IAAI,OAAO;YACjC;QACF;+BAAG;QAAC;QAAQ;KAAI;IAChB,OAAO;AACT;GARS;;QACK,4LAAM;;;KADX;AAUM,SAAS,YAAY,EAAE,MAAM,EAAE,YAAY,EAAiE;;IACzH,8BAA8B;IAC9B,MAAM,mBAAqC;QAAC;QAAS;KAAO;IAE5D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wMAAQ,EAAmB;IAC7D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wMAAQ,EACxC,eAAe;QAAC,aAAa,GAAG;QAAE,aAAa,GAAG;KAAC,GAAG;IAGxD,yCAAyC;IACzC,IAAA,yMAAS;iCAAC;YACR,IAAI,gBAAgB,CAAC,MAAM,aAAa,GAAG,GAAG;gBAC5C,aAAa;oBAAC,aAAa,GAAG;oBAAE,aAAa,GAAG;iBAAC;YACnD;QACF;gCAAG;QAAC;KAAa;IAEjB,IAAA,yMAAS;iCAAC;YACR,IAAI,WAAW,WAAW,WAAW,cAAc;gBACjD,MAAM,WAAW;sDAAY;wBAC3B;8DAAa,CAAA,OAAQ;oCACnB,IAAI,CAAC,EAAE,GAAG,CAAC,KAAK,MAAM,KAAK,GAAG,IAAI;oCAClC,IAAI,CAAC,EAAE,GAAG,CAAC,KAAK,MAAM,KAAK,GAAG,IAAI;iCACnC;;oBACH;qDAAG;gBACH;6CAAO,IAAM,cAAc;;YAC7B;QACF;gCAAG;QAAC;KAAO;IAEX;;IAEA,qBACE,4NAAC;QAAI,OAAO;YAAE,QAAQ;YAAQ,OAAO;YAAQ,UAAU;QAAW;;;0BAChE,4NAAC,yMAAY;gBACX,IAAG;gBAEH,QAAQ;gBACR,MAAM;gBACN,iBAAiB;gBACjB,OAAO;oBAAE,QAAQ;oBAAQ,OAAO;oBAAQ,YAAY;gBAAU;gBAC9D,aAAa;;kCAEb,4NAAC,mMAAS;wBACR,aAAY;wBACZ,KAAI;wBACJ,WAAU;;;;;;kCAGZ,4NAAC;wBAAW,QAAQ,WAAW,SAAS,YAAY;;;;;;kCAGpD,4NAAC,6LAAM;wBAAC,UAAU;wBAAW,MAAM;kCACjC,cAAA,4NAAC,2LAAK;sCAAC;;;;;;;;;;;oBAIR,WAAW,wBACV,4NAAC,6LAAM;wBAAC,UAAU;wBAAW,MAAM;kCACjC,cAAA,4NAAC,2LAAK;sCAAC;;;;;;;;;;;;eAvBP;;;;;;;;;;;;;;;AAyCZ;IA3EwB;MAAA"}}]
}